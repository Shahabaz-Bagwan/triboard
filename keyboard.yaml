units:
  # Change "cx" and "cy" to "u" or "U" for MX spacing
  kx: cx
  ky: cy
  stagger1: ky
  stagger2: 0.3ky
  stagger3: -0.6ky
  stagger4: -0.2ky

points:
  key:
    spread: kx
    padding: ky
  zones:
    matrix: 
      columns:
        pinky:
        ring:
          key:
            stagger: stagger1
        middle:
          key:
            stagger: stagger2
        index:
          key:
            stagger: stagger3
        inner:
          key:
            stagger: stagger4
      rows:
        bottom:
        home:
        top:
    thumbfan:
      anchor:
        ref: matrix_inner_bottom
        shift: [-kx, -ky]
      columns:
        inner:
        home:
      rows:
        thumb:
  #rotate: -20

outlines:
  raw:
    - what: rectangle
      where: true
      size: [kx, ky]
  keys:
    - what: rectangle
      where: true
      size: [kx-0.5, ky-0.5]
  mcu_circle:
    - what: circle
      operation: add
      where: matrix_middle_bottom
      radius: 2.3kx
    - what: polygon
      operation: intersect
      points:
        - ref: matrix_middle_bottom
          shift: [0, 0.5ky]
        - ref: matrix_inner_bottom
          shift: [0.5kx, 0.5ky]
        - ref: thumbfan_home_thumb
          shift: [0.5kx, -10ky] # Let the circle go anywhere it wants below the board
        - ref: thumbfan_inner_thumb
          shift: [-0.5kx, -10ky]
        - ref: matrix_pinky_bottom
          shift: [-0.5kx, -10ky]
        - ref: matrix_pinky_home
          shift: [-0.5kx, 0.5ky]

  board_noround:
    - what: rectangle
      where: true
      size: [kx, ky]
    - what: outline
      name: mcu_circle
      fillet: 1
      operation: add

  board:
    - what: outline
      name: board_noround
      fillet: 1

pcbs:
  main:
    outlines:
      main:
        outline: board
    footprints:
      choc_hotswap:
        what: choc
        where: true
        params:
          keycaps: true
          reverse: true
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diode:
        what: diode
        where: true
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [0, -0.3ky]
      xiao-ble:
        what: xiao
        params:
          orientation: down # Reset button on the bottom
        where:
          ref: matrix_pinky_bottom
          shift: [1.7kx, -0.1ky]
          rotate: 130
